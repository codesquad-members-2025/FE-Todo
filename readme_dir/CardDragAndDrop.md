# 카드 드래그 앤 드롭 설계

## 시나리오

- 사전 준비사항

  - 기본적으로 드래그가 불가능하므로 draggable="true"라는 속성을 아이템들에게 부여한다

- 이벤트 위임을 전체 칸반에 한다.(dragstart이벤트 감지)

  - 이때 drag관련 이벤트는 기본적으로 버블링이 안되서 캡처링으로 이벤트를 감지해야한다.

- 하나의 아이템에 dragstart이벤트가 발생한다.

  - event.target으로 아이템을 가져온다.👀(변수에 할당)
  - 해당 아이템에 dragging클래스를 추가한다(드래그시 다른 아이템과 구분 위해, css속성 부여\_opacity부여)
  - 저장한 아이템에 새로운 이벤트를 등록한다(드래그 종료시 dragging클래스 삭제)

- 아이템들이 각 칼럼 위로 드래그된다(칼럼에서 dragover이벤트 발생)

  - 각 칼럼(3개)에 dragover이벤트를 등록해야한다 (반복문으로 이벤트 등록 실행)
  - 기본적으로 깔려있는 디폴드값을 .preventDefault();로 해제해 준다.
  - **👁️이때 마우스가 칼럼 위를 지나다니는 동안은 계속해서 dragover이벤트가 계속해서 발생한다**
  - 이때 드래그중인 아이템이 어디로 갈 것인가? 를 정해줘야한다.

    - 마우스의 글로벌 과표계의 위치를 기준으로 **컨테이너 안의 아이템**의 위치와 비교를 한다.(이때 컨테이너 안의 아이템들중에 .dragging클래스가 없는 아이템들만 가져온다.)

  - 이 아이템들의 좌표와 마우스의 좌표를 비교해서 아이템들중에서 마우스와 가장 까가운 아이템을 찾는다.(위치를 비교할때 양방향을 신경쓰면 순서를 못정한다. 한쪽 방향만 신경써서 찾는다. )

    - 위치 비교는 y좌표만 신경쓴다.
    - 위치비교 offset : event.clientY - (box.top + box.height / 2)
    - event.clientY의 위치보다 작은 좌표에 있는 박스들은 모두 조건문에서 걸러낸다.(offset이 양수면 모두 거른다=> offset이 음수일 경우에만 조건문 실행)
    - 남은 아이템들 중에서 offset이 제일 작은 경우만 찾고 그 아이템을 반환한다.

  - 찾은 아이템은 두가지 경우의 수가 존재한다. (undefined:마우스가 가장 아래에 있는경우, 나머지는 모두 아이템이 존재)
    - undefined일 경우 갈럼의 제일 마지막에 넣는다 appendchild
    - 나머지는 찾은 아이템에 insertBefore를 한다

- 로그를 생성한다.
  일단 ui 구현부터하고 로그생성하자

  ***

  ## 에러 발생

  - 초반에 칼럼의 영역이 너무 작으면 dragover가 실행되지 않는다

    - -> 뷰포트 기준80%로 칼럼의 높이를 키워서 해결

  - 드래그할때 남은 아이템들이 너무 빠르게 움직인다.
  - 다른 칼럼으로 이동시 다른 칼럼의 아이템들도 딸려온다
